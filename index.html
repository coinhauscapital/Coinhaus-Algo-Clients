<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Coinhaus Capital - Algo Client Management</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 106, 213, 0.3) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(120, 200, 255, 0.3) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
            position: relative;
            z-index: 1;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 30px 35px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header h1 {
            color: #1a202c;
            font-size: 32px;
            margin-bottom: 8px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header p {
            color: #4a5568;
            font-size: 15px;
            font-weight: 500;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .connection-status {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
        }

        .connection-status.connected {
            background: #c6f6d5;
            color: #22543d;
        }

        .connection-status.disconnected {
            background: #fed7d7;
            color: #742a2a;
        }

        .connection-status .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: currentColor;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .stats-bar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 25px 35px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .stat-item {
            flex: 1;
            min-width: 150px;
        }

        .stat-value {
            font-size: 36px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .stat-label {
            font-size: 13px;
            color: #718096;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-top: 5px;
        }

        .tabs {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 15px 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            display: flex;
            gap: 10px;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .tab-btn {
            padding: 10px 20px;
            border: none;
            background: transparent;
            border-radius: 10px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            color: #4a5568;
        }

        .tab-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .tab-btn:hover:not(.active) {
            background: rgba(102, 126, 234, 0.1);
        }

        .actions-bar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 20px 30px;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 25px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            align-items: center;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .search-box {
            flex: 1;
            min-width: 250px;
            position: relative;
        }

        .search-box input {
            width: 100%;
            padding: 12px 40px 12px 15px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .search-box input:focus {
            outline: none;
            border-color: #667eea;
        }

        .search-icon {
            position: absolute;
            right: 15px;
            top: 50%;
            transform: translateY(-50%);
            color: #a0aec0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #5a67d8 0%, #6b42a0 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(102, 126, 234, 0.5);
        }

        .btn-secondary {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(72, 187, 120, 0.4);
        }

        .btn-secondary:hover {
            background: linear-gradient(135deg, #38a169 0%, #2f855a 100%);
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(72, 187, 120, 0.5);
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .btn-edit {
            background: #4299e1;
            color: white;
        }

        .btn-edit:hover {
            background: #3182ce;
        }

        .btn-delete {
            background: #fc8181;
            color: white;
        }

        .btn-delete:hover {
            background: #f56565;
        }

        .btn-restore {
            background: #48bb78;
            color: white;
        }

        .btn-restore:hover {
            background: #38a169;
        }

        .clients-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(450px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .client-card {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
            border: 1px solid rgba(255, 255, 255, 0.3);
            overflow: hidden;
        }

        .client-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .client-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 12px 40px rgba(102, 126, 234, 0.2);
        }

        .client-card:hover::before {
            opacity: 1;
        }

        .client-card.archived {
            opacity: 0.7;
            border-left: 4px solid #fc8181;
        }

        .client-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f7fafc;
        }

        .client-name {
            font-size: 20px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 5px;
        }

        .client-contact {
            font-size: 13px;
            color: #718096;
        }

        .archive-badge {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
            color: #742a2a;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 11px;
            font-weight: 600;
            box-shadow: 0 2px 8px rgba(252, 182, 159, 0.3);
        }

        .client-details {
            margin-bottom: 15px;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            padding: 8px 0;
            font-size: 14px;
            gap: 10px;
        }

        .detail-label {
            color: #718096;
            font-weight: 500;
            flex-shrink: 0;
        }

        .detail-value {
            color: #2d3748;
            font-weight: 600;
            text-align: right;
            word-break: break-word;
        }

        .credentials-section {
            background: #f7fafc;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
        }

        .credentials-title {
            font-size: 13px;
            font-weight: 600;
            color: #4a5568;
            margin-bottom: 10px;
        }

        .credential-item {
            margin-bottom: 10px;
        }

        .credential-item:last-child {
            margin-bottom: 0;
        }

        .credential-label {
            font-size: 11px;
            color: #a0aec0;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 4px;
        }

        .credential-value {
            display: flex;
            align-items: center;
            gap: 8px;
            background: white;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 13px;
            color: #2d3748;
            font-family: 'Courier New', monospace;
        }

        .credential-value input {
            border: none;
            background: transparent;
            flex: 1;
            font-family: 'Courier New', monospace;
            font-size: 13px;
            color: #2d3748;
        }

        .copy-btn {
            background: #667eea;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 11px;
            transition: all 0.2s;
        }

        .copy-btn:hover {
            background: #5a67d8;
        }

        .copy-btn.copied {
            background: #48bb78;
        }

        .card-actions {
            display: flex;
            gap: 8px;
            margin-top: 15px;
            padding-top: 15px;
            border-top: 2px solid #f7fafc;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(8px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 35px;
            max-width: 800px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .modal-header {
            margin-bottom: 25px;
        }

        .modal-header h2 {
            color: #2d3748;
            font-size: 24px;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-row.single {
            grid-template-columns: 1fr;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #4a5568;
            font-weight: 600;
            font-size: 14px;
        }

        .form-group label .required {
            color: #e53e3e;
            margin-left: 4px;
        }

        .form-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #667eea;
        }

        .form-section-title {
            font-size: 16px;
            font-weight: 700;
            color: #2d3748;
            margin: 30px 0 15px 0;
            padding-bottom: 10px;
            border-bottom: 2px solid #e2e8f0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .form-section-title:first-child {
            margin-top: 0;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            margin-top: 30px;
        }

        .btn-cancel {
            flex: 1;
            background: #e2e8f0;
            color: #4a5568;
        }

        .btn-cancel:hover {
            background: #cbd5e0;
        }

        .btn-save {
            flex: 2;
            background: #48bb78;
            color: white;
        }

        .btn-save:hover {
            background: #38a169;
        }

        .empty-state {
            background: white;
            border-radius: 12px;
            padding: 60px 30px;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.3;
        }

        .empty-state h3 {
            color: #2d3748;
            font-size: 20px;
            margin-bottom: 10px;
        }

        .empty-state p {
            color: #718096;
            margin-bottom: 25px;
        }

        .loading-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            z-index: 9999;
            align-items: center;
            justify-content: center;
        }

        .loading-overlay.show {
            display: flex;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #e2e8f0;
            border-top: 4px solid #667eea;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: #2d3748;
            color: white;
            padding: 16px 24px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 2000;
            display: none;
            align-items: center;
            gap: 12px;
            animation: slideIn 0.3s ease;
        }

        .toast.show {
            display: flex;
        }

        @keyframes slideIn {
            from {
                transform: translateX(400px);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        .password-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 10000;
        }

        .password-screen::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 50%, rgba(120, 119, 198, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 80% 80%, rgba(255, 106, 213, 0.4) 0%, transparent 50%),
                radial-gradient(circle at 40% 20%, rgba(120, 200, 255, 0.4) 0%, transparent 50%);
            pointer-events: none;
        }

        .password-container {
            background: rgba(255, 255, 255, 0.98);
            backdrop-filter: blur(10px);
            border-radius: 24px;
            padding: 50px 45px;
            max-width: 480px;
            width: 90%;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            animation: fadeInUp 0.5s ease;
            position: relative;
            z-index: 1;
            border: 1px solid rgba(255, 255, 255, 0.3);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .password-header {
            text-align: center;
            margin-bottom: 35px;
        }

        .password-header h1 {
            color: #1a202c;
            font-size: 32px;
            margin-bottom: 10px;
            font-weight: 800;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .password-header p {
            color: #718096;
            font-size: 15px;
        }

        .password-error {
            color: #e53e3e;
            font-size: 14px;
            text-align: center;
            min-height: 20px;
            font-weight: 500;
        }

        .password-footer {
            text-align: center;
            margin-top: 30px;
            padding-top: 25px;
            border-top: 2px solid #f7fafc;
        }

        .password-footer p {
            color: #a0aec0;
            font-size: 13px;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-10px); }
            20%, 40%, 60%, 80% { transform: translateX(10px); }
        }

        @media (max-width: 768px) {
            .clients-grid {
                grid-template-columns: 1fr;
            }
            .form-row {
                grid-template-columns: 1fr;
            }
            .stats-bar {
                flex-direction: column;
                gap: 15px;
            }
        }
    </style>
</head>
<body>
    <div class="loading-overlay" id="loadingOverlay">
        <div class="spinner"></div>
    </div>

    <!-- Login Screen -->
    <div class="password-screen" id="loginScreen">
        <div class="password-container">
            <div class="password-header">
                <h1>üíº Coinhaus Capital</h1>
                <p>Algo Client Management System</p>
                <p style="margin-top: 15px; color: #718096; font-size: 14px;">Sign in to access the system</p>
            </div>
            <form id="loginForm">
                <div class="form-group" style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 8px; color: #4a5568; font-weight: 600; font-size: 14px;">Email</label>
                    <input type="email" id="loginEmail" placeholder="your.email@company.com" required style="width: 100%; padding: 16px 20px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 16px;">
                </div>
                <div class="form-group" style="margin-bottom: 20px;">
                    <label style="display: block; margin-bottom: 8px; color: #4a5568; font-weight: 600; font-size: 14px;">Password</label>
                    <input type="password" id="loginPassword" placeholder="Enter your password" required style="width: 100%; padding: 16px 20px; border: 2px solid #e2e8f0; border-radius: 8px; font-size: 16px;">
                </div>
                <div id="loginError" class="password-error" style="margin-bottom: 15px;"></div>
                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 16px; font-size: 16px;">Login</button>
            </form>
            <div class="password-footer">
                <p>üîê Secure authentication for authorized team members</p>
            </div>
        </div>
    </div>

    <div class="container" id="mainApp" style="display: none;">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px;">
                <div>
                    <h1>üíº Coinhaus Capital</h1>
                    <p>Manage your algo trading subscription clients</p>
                </div>
                <div class="header-actions">
                    <span id="userEmail" style="color: #4a5568; font-size: 14px; font-weight: 500;"></span>
                    <button class="btn btn-small" onclick="logout()" style="background: #fc8181; color: white;">üö™ Logout</button>
                    <span class="connection-status disconnected" id="connectionStatus">
                        <span class="dot"></span>
                        Disconnected
                    </span>
                </div>
            </div>
        </div>

        <div class="stats-bar">
            <div class="stat-item">
                <div class="stat-value" id="totalClients">0</div>
                <div class="stat-label">Total Clients</div>
            </div>
            <div class="stat-item">
                <div class="stat-value" id="archivedCount">0</div>
                <div class="stat-label">Archived</div>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" data-tab="active">üìã Active Clients</button>
            <button class="tab-btn" data-tab="archive">üóÑÔ∏è Archive</button>
        </div>

        <div class="actions-bar">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="Search by name, client ID, or email...">
                <span class="search-icon">üîç</span>
            </div>
            <button class="btn btn-secondary" onclick="exportToExcel()">üìä Export Excel</button>
            <button class="btn btn-primary" onclick="openAddModal()">‚ûï Add Client</button>
        </div>

        <div id="clientsContainer"></div>
    </div>

    <!-- Client Modal -->
    <div class="modal" id="clientModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modalTitle">Add New Client</h2>
            </div>
            <form id="clientForm">
                <div class="form-section-title">Basic Information</div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label>Client Name<span class="required">*</span></label>
                        <input type="text" id="clientName" required>
                    </div>
                    <div class="form-group">
                        <label>Client ID<span class="required">*</span></label>
                        <input type="text" id="clientId" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Password<span class="required">*</span></label>
                        <input type="text" id="clientPassword" required>
                    </div>
                    <div class="form-group">
                        <label>Birth Year<span class="required">*</span></label>
                        <input type="number" id="birthYear" min="1900" max="2024" required>
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>TOTP<span class="required">*</span></label>
                        <input type="text" id="totp" required>
                    </div>
                    <div class="form-group">
                        <label>BOT API Key</label>
                        <input type="text" id="botApiKey">
                    </div>
                </div>

                <div class="form-section-title">Contact Information</div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Contact Number<span class="required">*</span></label>
                        <input type="tel" id="contactNum" required>
                    </div>
                    <div class="form-group">
                        <label>Mail ID<span class="required">*</span></label>
                        <input type="email" id="mailId" required>
                    </div>
                </div>

                <div class="form-section-title">Proxy Configuration</div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Proxy Host</label>
                        <input type="text" id="proxyHost">
                    </div>
                    <div class="form-group">
                        <label>Proxy Port</label>
                        <input type="text" id="proxyPort">
                    </div>
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Proxy Username</label>
                        <input type="text" id="proxyUsername">
                    </div>
                    <div class="form-group">
                        <label>Proxy Password</label>
                        <input type="text" id="proxyPassword">
                    </div>
                </div>

                <div class="form-row single">
                    <div class="form-group">
                        <label>Proxy IP</label>
                        <input type="text" id="proxyIp">
                    </div>
                </div>

                <div class="form-section-title">Aliceblue Credentials</div>

                <div class="form-row">
                    <div class="form-group">
                        <label>Approved Aliceblue App Key</label>
                        <input type="text" id="aliceblueAppKey">
                    </div>
                    <div class="form-group">
                        <label>Approved Aliceblue App Secret Key</label>
                        <input type="text" id="aliceblueAppSecret">
                    </div>
                </div>

                <div class="form-actions">
                    <button type="button" class="btn btn-cancel" onclick="closeModal()">Cancel</button>
                    <button type="submit" class="btn btn-save">Save Client</button>
                </div>
            </form>
        </div>
    </div>

    <div class="toast" id="toast">
        <span id="toastMessage"></span>
    </div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>

    <script>
        let db = null;
        let auth = null;
        let clients = [];
        let archivedClients = [];
        let editingClientId = null;
        let searchQuery = '';
        let isFirebaseConfigured = false;
        let currentUser = null;
        let currentTab = 'active';

        const firebaseConfig = {
            apiKey: "AIzaSyDiIAmZ5TXl8WCmacz3oKdFNfc-PBeqaz4",
            authDomain: "coinhaus-16l-algo-clients.firebaseapp.com",
            projectId: "coinhaus-16l-algo-clients",
            databaseURL: "https://coinhaus-16l-algo-clients-default-rtdb.firebaseio.com"
        };

        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('loginForm').addEventListener('submit', function(e) {
                e.preventDefault();
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                handleLogin(email, password);
            });
            
            initializeFirebase();
            
            document.getElementById('searchInput').addEventListener('input', function(e) {
                searchQuery = e.target.value.toLowerCase();
                renderClients();
            });

            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    currentTab = this.dataset.tab;
                    renderClients();
                });
            });

            document.getElementById('clientForm').addEventListener('submit', function(e) {
                e.preventDefault();
                saveClient();
            });

            document.getElementById('clientModal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });

            setInterval(cleanupExpiredArchive, 24 * 60 * 60 * 1000);
            cleanupExpiredArchive();
        });

        function checkAuthState() {
            if (!auth) return;
            auth.onAuthStateChanged((user) => {
                if (user) {
                    currentUser = user;
                    showMainApp();
                    document.getElementById('userEmail').textContent = user.email;
                } else {
                    currentUser = null;
                    showLoginScreen();
                }
            });
        }

        function showLoginScreen() {
            document.getElementById('loginScreen').style.display = 'flex';
            document.getElementById('mainApp').style.display = 'none';
        }

        function showMainApp() {
            document.getElementById('loginScreen').style.display = 'none';
            document.getElementById('mainApp').style.display = 'block';
            loadClientsFromFirebase();
        }

        async function handleLogin(email, password) {
            const errorEl = document.getElementById('loginError');
            errorEl.textContent = '';
            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                let errorMessage = '‚ùå Login failed. ';
                switch(error.code) {
                    case 'auth/invalid-email': errorMessage += 'Invalid email address.'; break;
                    case 'auth/user-disabled': errorMessage += 'This account has been disabled.'; break;
                    case 'auth/user-not-found': errorMessage += 'No account found with this email.'; break;
                    case 'auth/wrong-password': errorMessage += 'Incorrect password.'; break;
                    case 'auth/invalid-credential': errorMessage += 'Invalid email or password.'; break;
                    default: errorMessage += error.message;
                }
                errorEl.textContent = errorMessage;
                const container = document.querySelector('.password-container');
                container.style.animation = 'shake 0.5s';
                setTimeout(() => container.style.animation = 'fadeInUp 0.5s ease', 500);
            }
        }

        function logout() {
            if (auth) auth.signOut();
        }

        function initializeFirebase() {
            try {
                if (firebase.apps.length === 0) {
                    firebase.initializeApp(firebaseConfig);
                }
                db = firebase.database();
                auth = firebase.auth();
                isFirebaseConfigured = true;
                updateConnectionStatus(true);
                checkAuthState();
            } catch (error) {
                console.error('Firebase initialization error:', error);
                showToast('Error connecting to Firebase');
                updateConnectionStatus(false);
            }
        }

        function updateConnectionStatus(connected) {
            const statusEl = document.getElementById('connectionStatus');
            if (connected) {
                statusEl.className = 'connection-status connected';
                statusEl.innerHTML = '<span class="dot"></span> Connected';
            } else {
                statusEl.className = 'connection-status disconnected';
                statusEl.innerHTML = '<span class="dot"></span> Disconnected';
            }
        }

        function loadClientsFromFirebase() {
            if (!db) return;
            showLoading();
            db.ref('clients').on('value', (snapshot) => {
                clients = [];
                snapshot.forEach((childSnapshot) => {
                    clients.push({ id: childSnapshot.key, ...childSnapshot.val() });
                });
                clients.sort((a, b) => new Date(b.createdAt) - new Date(a.createdAt));
                renderClients();
                updateStats();
            });
            db.ref('archive').on('value', (snapshot) => {
                archivedClients = [];
                snapshot.forEach((childSnapshot) => {
                    archivedClients.push({ id: childSnapshot.key, ...childSnapshot.val() });
                });
                archivedClients.sort((a, b) => new Date(b.archivedAt) - new Date(a.archivedAt));
                renderClients();
                updateStats();
                hideLoading();
            });
        }

        function renderClients() {
            const container = document.getElementById('clientsContainer');
            const dataToRender = currentTab === 'active' ? clients : archivedClients;
            let filteredData = dataToRender.filter(client => {
                return searchQuery === '' || 
                    (client.name && client.name.toLowerCase().includes(searchQuery)) ||
                    (client.clientId && client.clientId.toLowerCase().includes(searchQuery)) ||
                    (client.mailId && client.mailId.toLowerCase().includes(searchQuery));
            });

            if (filteredData.length === 0) {
                const emptyIcon = currentTab === 'active' ? 'üìã' : 'üóÑÔ∏è';
                const emptyTitle = currentTab === 'active' ? 'No clients yet' : 'No archived clients';
                const emptyMessage = currentTab === 'active' ? 'Add your first client to get started' : 'Deleted clients will appear here for 15 days';
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">${emptyIcon}</div>
                        <h3>${emptyTitle}</h3>
                        <p>${emptyMessage}</p>
                        ${currentTab === 'active' && clients.length === 0 ? '<button class="btn btn-primary" onclick="openAddModal()">‚ûï Add First Client</button>' : ''}
                    </div>
                `;
                return;
            }

            container.innerHTML = '<div class="clients-grid">' + 
                filteredData.map(client => renderClientCard(client, currentTab === 'archive')).join('') + 
                '</div>';
        }

        function renderClientCard(client, isArchived) {
            const daysLeft = isArchived ? getDaysUntilDeletion(client.archivedAt) : null;
            return `
                <div class="client-card ${isArchived ? 'archived' : ''}">
                    <div class="client-header">
                        <div>
                            <div class="client-name">${escapeHtml(client.name)}</div>
                            <div class="client-contact">üì± ${escapeHtml(client.contactNum)} ‚Ä¢ üìß ${escapeHtml(client.mailId)}</div>
                        </div>
                        ${isArchived ? `<span class="archive-badge">${daysLeft} days left</span>` : ''}
                    </div>
                    <div class="client-details">
                        <div class="detail-row"><span class="detail-label">Client ID:</span><span class="detail-value">${escapeHtml(client.clientId)}</span></div>
                        <div class="detail-row"><span class="detail-label">Birth Year:</span><span class="detail-value">${escapeHtml(client.birthYear)}</span></div>
                    </div>
                    <div class="credentials-section">
                        <div class="credentials-title">üîë Login Credentials</div>
                        <div class="credential-item">
                            <div class="credential-label">Password</div>
                            <div class="credential-value">
                                <input type="text" value="${escapeHtml(client.password)}" readonly>
                                <button class="copy-btn" onclick="copyToClipboard('${escapeHtml(client.password)}', this)">Copy</button>
                            </div>
                        </div>
                        <div class="credential-item">
                            <div class="credential-label">TOTP</div>
                            <div class="credential-value">
                                <input type="text" value="${escapeHtml(client.totp)}" readonly>
                                <button class="copy-btn" onclick="copyToClipboard('${escapeHtml(client.totp)}', this)">Copy</button>
                            </div>
                        </div>
                    </div>
                    ${client.botApiKey ? `
                        <div class="credentials-section">
                            <div class="credentials-title">ü§ñ BOT API</div>
                            <div class="credential-item">
                                <div class="credential-label">API Key</div>
                                <div class="credential-value">
                                    <input type="text" value="${escapeHtml(client.botApiKey)}" readonly>
                                    <button class="copy-btn" onclick="copyToClipboard('${escapeHtml(client.botApiKey)}', this)">Copy</button>
                                </div>
                            </div>
                        </div>
                    ` : ''}
                    ${(client.proxyHost || client.proxyPort || client.proxyIp) ? `
                        <div class="credentials-section">
                            <div class="credentials-title">üåê Proxy Configuration</div>
                            ${client.proxyHost ? `<div class="credential-item"><div class="credential-label">Host</div><div class="credential-value"><input type="text" value="${escapeHtml(client.proxyHost)}" readonly><button class="copy-btn" onclick="copyToClipboard('${escapeHtml(client.proxyHost)}', this)">Copy</button></div></div>` : ''}
                            ${client.proxyPort ? `<div class="credential-item"><div class="credential-label">Port</div><div class="credential-value"><input type="text" value="${escapeHtml(client.proxyPort)}" readonly><button class="copy-btn" onclick="copyToClipboard('${escapeHtml(client.proxyPort)}', this)">Copy</button></div></div>` : ''}
                            ${client.proxyUsername ? `<div class="credential-item"><div class="credential-label">Username</div><div class="credential-value"><input type="text" value="${escapeHtml(client.proxyUsername)}" readonly><button class="copy-btn" onclick="copyToClipboard('${escapeHtml(client.proxyUsername)}', this)">Copy</button></div></div>` : ''}
                            ${client.proxyPassword ? `<div class="credential-item"><div class="credential-label">Password</div><div class="credential-value"><input type="text" value="${escapeHtml(client.proxyPassword)}" readonly><button class="copy-btn" onclick="copyToClipboard('${escapeHtml(client.proxyPassword)}', this)">Copy</button></div></div>` : ''}
                            ${client.proxyIp ? `<div class="credential-item"><div class="credential-label">IP</div><div class="credential-value"><input type="text" value="${escapeHtml(client.proxyIp)}" readonly><button class="copy-btn" onclick="copyToClipboard('${escapeHtml(client.proxyIp)}', this)">Copy</button></div></div>` : ''}
                        </div>
                    ` : ''}
                    ${(client.aliceblueAppKey || client.aliceblueAppSecret) ? `
                        <div class="credentials-section">
                            <div class="credentials-title">üî∑ Aliceblue</div>
                            ${client.aliceblueAppKey ? `<div class="credential-item"><div class="credential-label">App Key</div><div class="credential-value"><input type="text" value="${escapeHtml(client.aliceblueAppKey)}" readonly><button class="copy-btn" onclick="copyToClipboard('${escapeHtml(client.aliceblueAppKey)}', this)">Copy</button></div></div>` : ''}
                            ${client.aliceblueAppSecret ? `<div class="credential-item"><div class="credential-label">App Secret</div><div class="credential-value"><input type="text" value="${escapeHtml(client.aliceblueAppSecret)}" readonly><button class="copy-btn" onclick="copyToClipboard('${escapeHtml(client.aliceblueAppSecret)}', this)">Copy</button></div></div>` : ''}
                        </div>
                    ` : ''}
                    <div class="card-actions">
                        ${isArchived ? `
                            <button class="btn btn-small btn-restore" onclick="restoreClient('${client.id}')">‚ôªÔ∏è Restore</button>
                            <button class="btn btn-small btn-delete" onclick="permanentlyDeleteClient('${client.id}')">üóëÔ∏è Delete Forever</button>
                        ` : `
                            <button class="btn btn-small btn-edit" onclick="editClient('${client.id}')">‚úèÔ∏è Edit</button>
                            <button class="btn btn-small btn-delete" onclick="deleteClient('${client.id}')">üóëÔ∏è Delete</button>
                        `}
                    </div>
                </div>
            `;
        }

        function openAddModal() {
            if (!isFirebaseConfigured) {
                showToast('Please wait for Firebase to connect');
                return;
            }
            editingClientId = null;
            document.getElementById('modalTitle').textContent = 'Add New Client';
            document.getElementById('clientForm').reset();
            document.getElementById('clientModal').classList.add('active');
        }

        function editClient(id) {
            const client = clients.find(c => c.id === id);
            if (!client) return;
            editingClientId = id;
            document.getElementById('modalTitle').textContent = 'Edit Client';
            document.getElementById('clientName').value = client.name || '';
            document.getElementById('clientId').value = client.clientId || '';
            document.getElementById('clientPassword').value = client.password || '';
            document.getElementById('birthYear').value = client.birthYear || '';
            document.getElementById('totp').value = client.totp || '';
            document.getElementById('contactNum').value = client.contactNum || '';
            document.getElementById('mailId').value = client.mailId || '';
            document.getElementById('botApiKey').value = client.botApiKey || '';
            document.getElementById('proxyHost').value = client.proxyHost || '';
            document.getElementById('proxyPort').value = client.proxyPort || '';
            document.getElementById('proxyUsername').value = client.proxyUsername || '';
            document.getElementById('proxyPassword').value = client.proxyPassword || '';
            document.getElementById('proxyIp').value = client.proxyIp || '';
            document.getElementById('aliceblueAppKey').value = client.aliceblueAppKey || '';
            document.getElementById('aliceblueAppSecret').value = client.aliceblueAppSecret || '';
            document.getElementById('clientModal').classList.add('active');
        }

        async function deleteClient(id) {
            if (!confirm('Move this client to archive? You can restore it within 15 days.')) return;
            if (!db) return;
            try {
                const client = clients.find(c => c.id === id);
                if (!client) return;
                await db.ref('archive/' + id).set({ ...client, archivedAt: new Date().toISOString() });
                await db.ref('clients/' + id).remove();
                showToast('Client moved to archive');
            } catch (error) {
                console.error('Error archiving client:', error);
                showToast('Error archiving client');
            }
        }

        async function restoreClient(id) {
            if (!confirm('Restore this client to active clients?')) return;
            if (!db) return;
            try {
                const client = archivedClients.find(c => c.id === id);
                if (!client) return;
                const { archivedAt, ...clientData } = client;
                await db.ref('clients/' + id).set(clientData);
                await db.ref('archive/' + id).remove();
                showToast('Client restored successfully');
            } catch (error) {
                console.error('Error restoring client:', error);
                showToast('Error restoring client');
            }
        }

        async function permanentlyDeleteClient(id) {
            if (!confirm('PERMANENTLY delete this client? This CANNOT be undone!')) return;
            if (!db) return;
            try {
                await db.ref('archive/' + id).remove();
                showToast('Client permanently deleted');
            } catch (error) {
                console.error('Error deleting client:', error);
                showToast('Error deleting client');
            }
        }

        async function cleanupExpiredArchive() {
            if (!db) return;
            const fifteenDaysAgo = new Date();
            fifteenDaysAgo.setDate(fifteenDaysAgo.getDate() - 15);
            archivedClients.forEach(async (client) => {
                if (new Date(client.archivedAt) < fifteenDaysAgo) {
                    try {
                        await db.ref('archive/' + client.id).remove();
                        console.log('Auto-deleted expired archive:', client.name);
                    } catch (error) {
                        console.error('Error auto-deleting:', error);
                    }
                }
            });
        }

        function getDaysUntilDeletion(archivedAt) {
            const archived = new Date(archivedAt);
            const deleteDate = new Date(archived);
            deleteDate.setDate(deleteDate.getDate() + 15);
            const now = new Date();
            const diffTime = deleteDate - now;
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            return Math.max(0, diffDays);
        }

        function closeModal() {
            document.getElementById('clientModal').classList.remove('active');
            editingClientId = null;
        }

        async function saveClient() {
            if (!db) return;
            const clientData = {
                name: document.getElementById('clientName').value,
                clientId: document.getElementById('clientId').value,
                password: document.getElementById('clientPassword').value,
                birthYear: document.getElementById('birthYear').value,
                totp: document.getElementById('totp').value,
                contactNum: document.getElementById('contactNum').value,
                mailId: document.getElementById('mailId').value,
                botApiKey: document.getElementById('botApiKey').value,
                proxyHost: document.getElementById('proxyHost').value,
                proxyPort: document.getElementById('proxyPort').value,
                proxyUsername: document.getElementById('proxyUsername').value,
                proxyPassword: document.getElementById('proxyPassword').value,
                proxyIp: document.getElementById('proxyIp').value,
                aliceblueAppKey: document.getElementById('aliceblueAppKey').value,
                aliceblueAppSecret: document.getElementById('aliceblueAppSecret').value,
                updatedAt: new Date().toISOString()
            };
            try {
                if (editingClientId) {
                    clientData.createdAt = clients.find(c => c.id === editingClientId).createdAt;
                    await db.ref('clients/' + editingClientId).update(clientData);
                    showToast('Client updated successfully');
                } else {
                    clientData.createdAt = new Date().toISOString();
                    await db.ref('clients').push(clientData);
                    showToast('Client added successfully');
                }
                closeModal();
            } catch (error) {
                console.error('Error saving client:', error);
                showToast('Error saving client');
            }
        }

        function updateStats() {
            document.getElementById('totalClients').textContent = clients.length;
            document.getElementById('archivedCount').textContent = archivedClients.length;
        }

        function copyToClipboard(text, button) {
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = '‚úì Copied';
                button.classList.add('copied');
                setTimeout(() => {
                    button.textContent = originalText;
                    button.classList.remove('copied');
                }, 2000);
                showToast('Copied to clipboard!');
            });
        }

        function exportToExcel() {
            if (clients.length === 0) {
                showToast('No clients to export');
                return;
            }
            const headers = ['Client Name', 'Client ID', 'Password', 'Birth Year', 'TOTP', 'Contact Number', 'Mail ID', 'BOT API Key', 'Proxy Host', 'Proxy Port', 'Proxy Username', 'Proxy Password', 'Proxy IP', 'Aliceblue App Key', 'Aliceblue App Secret'];
            let csv = headers.join(',') + '\n';
            clients.forEach(client => {
                const row = [
                    `"${client.name || ''}"`,
                    `"${client.clientId || ''}"`,
                    `"${client.password || ''}"`,
                    `"${client.birthYear || ''}"`,
                    `"${client.totp || ''}"`,
                    `"${client.contactNum || ''}"`,
                    `"${client.mailId || ''}"`,
                    `"${client.botApiKey || ''}"`,
                    `"${client.proxyHost || ''}"`,
                    `"${client.proxyPort || ''}"`,
                    `"${client.proxyUsername || ''}"`,
                    `"${client.proxyPassword || ''}"`,
                    `"${client.proxyIp || ''}"`,
                    `"${client.aliceblueAppKey || ''}"`,
                    `"${client.aliceblueAppSecret || ''}"`
                ];
                csv += row.join(',') + '\n';
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `coinhaus-clients-${new Date().toISOString().split('T')[0]}.csv`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
            showToast('Excel file exported successfully!');
        }

        function showLoading() {
            document.getElementById('loadingOverlay').classList.add('show');
        }

        function hideLoading() {
            document.getElementById('loadingOverlay').classList.remove('show');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            document.getElementById('toastMessage').textContent = message;
            toast.classList.add('show');
            setTimeout(() => toast.classList.remove('show'), 3000);
        }

        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
